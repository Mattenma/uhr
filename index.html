<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wecker</title>
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
  <style>
    /* Deine CSS Styles hier */
  </style>
</head>
<body>

<nav class="icon-container" id="icon-container">
  <span></span>
  <span></span>
</nav>

<div class="menu-overlay" id="menu-overlay">
  <div class="menu-content">
    <a href="/plus/index.html">Home</a>
    <a href="/timer/index.html">Timer</a>
    <a href="/uhr/index.html">Wecker</a>
    <a href="/rendite/index.html">Rendite</a>
    <a href="/plus/about.html">About</a>
  </div>
</div>

<div class="timer-container">
  <input type="text" id="timeInput" class="input-field" placeholder="HH:MM oder HH.MM" autofocus>
  <div id="timerDisplay" class="timer-display"></div>
  <div id="targetTimeDisplay" class="target-time-display"></div>
  <div class="progress-bar-container" id="progressBarContainer">
    <div id="progressBar" class="progress-bar"></div>
  </div>
  <i id="resetButton" class="material-icons reset-button">replay</i>
  <audio id="alarmSound" src="alarm.mp3" preload="auto"></audio>
</div>

<div class="dark-mode-icon" id="dark-mode-toggle">&#x2600;</div>

<script>
  const iconContainer = document.getElementById('icon-container');
  const menuOverlay = document.getElementById('menu-overlay');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const body = document.body;

  iconContainer.addEventListener('click', () => {
    iconContainer.classList.toggle('open');
    menuOverlay.style.display = iconContainer.classList.contains('open') ? 'flex' : 'none';
  });

  darkModeToggle.addEventListener('click', () => {
    body.classList.toggle('dark-mode');
  });

  const timeInput = document.getElementById('timeInput');
  const timerDisplay = document.getElementById('timerDisplay');
  const targetTimeDisplay = document.getElementById('targetTimeDisplay');
  const progressBar = document.getElementById('progressBar');
  const progressBarContainer = document.getElementById('progressBarContainer');
  const resetButton = document.getElementById('resetButton');
  const alarmSound = document.getElementById('alarmSound');

  let timer;
  let totalTime;
  let remainingTime;
  let targetTime;
  let timerPausedAt;

  timeInput.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      startTimer();
    }
  });

  resetButton.addEventListener('click', resetTimer);

  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      timerPausedAt = Date.now();
    } else {
      const now = Date.now();
      const elapsed = Math.floor((now - timerPausedAt) / 1000);
      remainingTime -= elapsed;
      if (remainingTime <= 0) {
        remainingTime = 0;
        if (!alarmSound.played.length) {
          alarmSound.play();
        }
      } else {
        updateTimerDisplay();
        updateProgressBar();
      }
    }
  });

  function startTimer() {
    const inputTime = parseTimeInput(timeInput.value);
    if (!inputTime) {
      alert('Bitte geben Sie eine gültige Uhrzeit im Format HH:MM oder HH.MM ein.');
      return;
    }

    targetTime = inputTime;
    const now = new Date();
    const targetDateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), targetTime.hours, targetTime.minutes, 0);
    const currentTime = now.getTime();
    const targetTimeMillis = targetDateTime.getTime();

    if (targetTimeMillis <= currentTime) {
      alert('Die eingegebene Uhrzeit liegt in der Vergangenheit.');
      return;
    }

    totalTime = Math.floor((targetTimeMillis - currentTime) / 1000);
    remainingTime = totalTime;
    timeInput.style.display = 'none';
    resetButton.style.display = 'inline-block';
    progressBarContainer.style.display = 'block';
    updateTimerDisplay();
    updateProgressBar();

    timer = setInterval(() => {
      const now = Date.now();
      remainingTime = Math.floor((targetTimeMillis - now) / 1000);
      if (remainingTime < 0) remainingTime = 0;
      updateTimerDisplay();
      updateProgressBar();

      if (remainingTime <= 0) {
        clearInterval(timer);
        remainingTime = 0;
        timerDisplay.textContent = 'Wecker abgelaufen';
        document.title = 'Wecker abgelaufen';
        if (!alarmSound.played.length) {
          alarmSound.play();
        }
      }
    }, 1000);
  }

  function parseTimeInput(input) {
    let match = input.match(/^(\d{1,2}):(\d{2})$/);
    if (!match) {
      match = input.match(/^(\d{1,2})\.(\d{2})$/);
    }
    if (!match) return null;

    const hours = parseInt(match[1], 10);
    const minutes = parseInt(match[2], 10);

    if (hours < 0 || hours > 23 || minutes < 0 || minutes > 59) {
      return null;
    }

    return { hours, minutes };
  }

  function updateTimerDisplay() {
    if (remainingTime < 0) remainingTime = 0;
    const hours = Math.floor(remainingTime / 3600);
    const minutes = Math.floor((remainingTime % 3600) / 60);
    const seconds = remainingTime % 60;

    let displayText;
    let titleText;

    if (remainingTime > 60) {
      if (hours > 0) {
        displayText = `${hours}:${minutes.toString().padStart(2, '0')}h`;
        titleText = displayText;
      } else {
        displayText = `${minutes}m`;
        titleText = displayText;
      }
    } else {
      displayText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}m`;
      titleText = displayText;
    }

    timerDisplay.textContent = displayText;
    document.title = titleText;

    const progress = Math.round(((totalTime - remainingTime) / totalTime) * 6);
    const filled = '█'.repeat(progress);
    const empty = '▁'.repeat(6 - progress);
    document.title = titleText + ' ' + filled + empty;

    updateTargetTimeDisplay();
  }

  function updateTargetTimeDisplay() {
    const targetTimeText = `${targetTime.hours.toString().padStart(2, '0')}:${targetTime.minutes.toString().padStart(2, '0')}`;
    targetTimeDisplay.textContent = `Anvisierte Uhrzeit: ${targetTimeText}`;
  }

  function updateProgressBar() {
    const progress = ((totalTime - remainingTime) / totalTime) * 100;
    progressBar.style.width = progress + '%';
  }

  function resetTimer() {
    clearInterval(timer);
    timeInput.style.display = 'inline-block';
    resetButton.style.display = 'none';
    progressBarContainer.style.display = 'none';
    timerDisplay.textContent = '';
    targetTimeDisplay.textContent = '';
    progressBar.style.width = '0%';
    timeInput.value = '';
    timeInput.focus();
    document.title = 'Wecker';
  }
</script>

</body>
</html>
